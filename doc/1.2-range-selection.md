# 1.2 - 区间选择与分段测量

本功能用于在图表上拖拽选区，查看涨跌幅与时间跨度，并支持区间内“二分段”对比。核心代码在 `static/js/range.js`。

## 1. 基础拖拽选区

交互流程：
1. 在图表上按下鼠标左键（`mousedown`）
2. 记录起点 bar（来自 `getCrosshairBar()`）
3. 拖动时更新半透明遮罩、提示框和左右价格标签
4. 松开鼠标后“冻结”结果，直到用户主动取消

显示内容：
- **范围涨跌幅**：使用起点价与终点价计算百分比
- **范围时长**：秒或分钟（根据当前分辨率）
- **左右价格标签**：显示起点价与终点价

## 2. 冻结与取消逻辑

- 松开鼠标后进入 `frozen` 状态，结果保留
- 以下操作会清除选区：
  - 点击图表外区域
  - 按下 `Escape`
  - 缩放/滚动图表（通过订阅 visible range 变化触发清除）

这样可以避免视图变化后选区与数据错位。

## 3. 分段测量（Shift）

当选区已冻结时：
- 按住 `Shift` 并在选区内点击，会进入“分段”模式
- 在选区中拖动鼠标，显示中线与中间价格
- 同时生成“左半段”和“右半段”的涨跌幅与时长

设计目的：
- 快速比较区间内的两个子趋势
- 不需要重新选两次区间

## 4. 技术细节

- 选区基于 **十字光标落点** 的价格/时间，不依赖像素计算
- 拖拽时会临时关闭图表的滚动/缩放交互，避免冲突
- 恢复交互后自动订阅视图变化，确保选区可被正确清除
